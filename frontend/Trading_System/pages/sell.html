<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sell Stocks | Stock Trading Simulator</title>
    <meta
      name="description"
      content="Place simulated sell orders with clear confirmations and totals."
    />
    <meta name="robots" content="index,follow" />
    <meta name="theme-color" content="#0a2540" />
    <meta name="color-scheme" content="light dark" />
    <link rel="icon" href="../images/favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="../images/apple-touch-icon.png" />
    <link rel="canonical" href="/pages/sell.html" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Sell • Stock Trading Simulator" />
    <meta
      property="og:description"
      content="Simulate sell orders with a professional, minimalist workflow."
    />
    <meta property="og:image" content="../images/social-card.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Sell • Stock Trading Simulator" />
    <meta
      name="twitter:description"
      content="Simulate sell orders with a professional, minimalist workflow."
    />
    <meta name="twitter:image" content="../images/social-card.png" />
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body>
    <div class="app">
      <header class="site-header" role="banner">
        <div class="branding">
          <h1>Stock Trading Simulator</h1>
        </div>
      </header>

      <nav class="site-nav" role="navigation" aria-label="Primary">
        <div class="nav-container">
          <label
            for="nav-toggle"
            class="nav-toggle-label"
            aria-label="Toggle navigation"
          >
            <span class="bar"></span>
          </label>
          <input type="checkbox" id="nav-toggle" class="nav-toggle" />
          <ul class="menu">
            <li><a href="../index.html">Home</a></li>
            <li><a href="./portfolio.html">Portfolio</a></li>
            <li><a href="./buy.html">Buy Stocks</a></li>
            <li><a href="./sell.html" aria-current="page">Sell Stocks</a></li>
            <li><a href="./transactions.html">Transactions</a></li>
            <li><a href="./deposit.html">Deposit</a></li>
            <li><a href="./withdraw.html">Withdraw</a></li>
            <li><a href="./login.html">Logout</a></li>
            <li class="admin-only">
              <a href="./admin-create-stock.html">Create New Stock</a>
            </li>
            <li class="admin-only">
              <a href="./admin-market-hours.html">Change Market Hours</a>
            </li>
            <li class="admin-only">
              <a href="./admin-market-schedule.html">Change Market Schedule</a>
            </li>
          </ul>
        </div>
      </nav>

      <main class="site-main">
        <div class="container">
          <section class="card" aria-labelledby="sell-title">
            <h2 class="page-title" id="sell-title">Sell Stock</h2>
            <div class="grid two">
              <div>
                <div class="section-title">Your Capital</div>
                <div class="stat">
                  <span class="label">Balance</span
                  ><span class="value">$—</span>
                </div>
              </div>
              <div>
                <div class="section-title">Stock Order</div>
                <p class="subtle">
                  Select the stock to sell. A confirmation will appear before
                  placing the order.
                </p>
              </div>
            </div>

            <div class="msg success" role="status" aria-live="polite">
              Sell order placed successfully.
            </div>
            <div class="msg error" role="alert" aria-live="polite">
              You do not have enough shares.
            </div>

            <form class="form" action="#" method="post" novalidate>
              <div class="form-row">
                <label for="sellTicker">Owned Stock</label>
                <select id="sellTicker" name="ticker" required>
                  <option value="">Select a stock</option>
                  <option value="AAPL">AAPL — 10 shares</option>
                </select>
              </div>
              <div class="form-row">
                <label for="sellQty">Quantity</label>
                <input
                  type="number"
                  id="sellQty"
                  name="quantity"
                  min="1"
                  step="1"
                  required
                />
              </div>
              <div class="grid two">
                <div>
                  <div class="section-title">Current Price</div>
                  <div class="stat">
                    <span class="label">Price</span
                    ><span class="value">$—</span>
                  </div>
                </div>
                <div>
                  <div class="section-title">Total Value</div>
                  <div class="stat">
                    <span class="label">Total</span
                    ><span class="value">$—</span>
                  </div>
                </div>
              </div>
              <div class="section-title">Chart</div>
              <div class="chart" aria-label="Stock chart placeholder">
                Stock chart will render here
              </div>
              <div class="actions">
                <button type="submit" class="btn btn-primary">Sell</button>
                <a class="btn btn-cancel" href="../index.html">Cancel</a>
              </div>
            </form>
          </section>
        </div>
      </main>

      <footer class="site-footer" role="contentinfo">
        <div class="footer-inner">
          <div class="footer-top">
            <div class="footer-brand">
              <h3>Stock Trading Simulator</h3>
              <p>Sell positions with clarity and confirmation.</p>
            </div>
            <div class="footer-links">
              <h4>Explore</h4>
              <ul>
                <li><a href="./portfolio.html">Portfolio</a></li>
                <li><a href="./transactions.html">Transactions</a></li>
              </ul>
            </div>
            <div class="footer-links">
              <h4>Support</h4>
              <ul>
                <li><a href="mailto:support@example.com">Contact Us</a></li>
                <li><a href="./login.html">Login</a></li>
              </ul>
            </div>
          </div>
          <div class="footer-bottom">
            <span>© 2025 Stock Trading Simulator</span>
            <div class="social">
              <a href="#" aria-label="Twitter">T</a>
              <a href="#" aria-label="LinkedIn">in</a>
              <a href="#" aria-label="GitHub">GH</a>
            </div>
          </div>
        </div>
      </footer>
    </div>
	<script>
		// Replace this with your actual API Gateway Invoke URL
		window.API_BASE_URL = "https://6hhdszthdg.execute-api.us-east-1.amazonaws.com/";
	</script>
	<script type="module">
	import { requireAuth, placeOrder, renderCash } from "../assets/api.js";

	// Requires login & (optionally) show cash in a header <span id="cash-amount">
	requireAuth();
	renderCash();

	// Grabs DOM
	const form = document.querySelector("form");
	const tickerInput = document.getElementById("sellTicker") || document.getElementById("ticker");
	const qtyInput = document.getElementById("sellQty") || document.getElementById("quantity");

	// Optional message boxes (use if present; otherwise we fall back to alert)
	const msgSuccess = document.querySelector(".msg.success");
	const msgError = document.querySelector(".msg.error");
	if (msgSuccess) msgSuccess.style.display = "none";
	if (msgError) msgError.style.display = "none";

	// Helper
	const fmt = (n) => Number(n).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });

	// (Optional) prefill ticker via ?ticker=ACME
	const params = new URLSearchParams(location.search);
	const presetTicker = params.get("ticker");
	if (presetTicker && tickerInput) tickerInput.value = presetTicker.toUpperCase();

	form.addEventListener("submit", async (e) => {
		e.preventDefault();

		const rawTicker = (tickerInput?.value || "").trim().toUpperCase();
		const rawQty = (qtyInput?.value || "").trim();
		const qty = Number(rawQty);

		if (!rawTicker) return showError("Enter a ticker symbol (e.g., ACME).");
		if (!rawQty || isNaN(qty) || qty <= 0) return showError("Enter a valid quantity greater than 0.");

		const submitBtn = form.querySelector('button[type="submit"], input[type="submit"]');
		if (submitBtn) submitBtn.disabled = true;

		try {
		// POST /trades/order { ticker, side: "sell", quantity }
		const res = await placeOrder({ ticker: rawTicker, side: "sell", quantity: qty });

		if (qtyInput) qtyInput.value = "";
			showSuccess(`SELL ${res.ticker} @ $${fmt(res.price)} × ${res.quantity} = $${fmt(res.total_value)}`);

		// Refreshs cash shown
		await renderCash();
		} 
		catch (err) {
			showError(err.message || "Sell order failed.");
		} 
		finally {
			if (submitBtn) submitBtn.disabled = false;
		}
	});

	function showSuccess(message) {
		if (msgSuccess) {
		msgSuccess.textContent = message;
		msgSuccess.style.display = "block";
    } 
	else {
      alert(message);
    }
    if (msgError) msgError.style.display = "none";
	}

	function showError(message) {
		if (msgError) {
		msgError.textContent = message;
		msgError.style.display = "block";
		} 
		else {
			alert(message);
		}
		if (msgSuccess) msgSuccess.style.display = "none";
		}
	</script>
	<script type="module">
      import { listTickers } from "../js/api.js";

      listTickers().then(stocks => {
        const select = document.getElementById("tickerSelect");
        if (!select) return;
        select.innerHTML = "<option value=''>Select Stock to Sell</option>";
        stocks.forEach(s => {
          const opt = document.createElement("option");
          opt.value = s.ticker;
          opt.textContent = `${s.ticker} - ${s.company_name}`;
          select.appendChild(opt);
        });
      });
    </script>
  </body>
</html>
